{% include "components/open_boiler_plate.html" %}
<div id="clock">
    <span id="year"></span>
    <span id="month"></span>
    <span id="day"></span>
    <span id="hour"></span>
    <span id="minute"></span>
    <span id="second"></span>
</div>
    <div id="ogham-switch-container">
      <span id="ogham-label">{{ "ogham" | ogham | safe }}</span>
      <div id="toggle-button-holder"><div class="slider"></div></div>
      <span id="seanchlo-label">{{ "seanchloo" | seanchlo }}</span>
    </div>
<div id="countdown-container">
    {%- for countdown in countdowns %}
    <div id="{{ countdown.label }}-countdown">
        <span class="ogham">{{ countdown.gaeilge | ogham | safe }}</span
        ><span class="seanchlo hidden">{{ countdown.gaeilge | seanchlo }}</span><span id="{{ countdown.label }}-days"></span>
    </div>
    {%- endfor %}
</div>
<script>
      let useOgham = true;

      function toggleOgham() {
        useOgham = !useOgham;
        if(useOgham){
            document.querySelectorAll('.ogham').forEach((item) => {
                    item.classList.remove("hidden");
            });
            document.querySelectorAll('.seanchlo').forEach((item) => {
                    item.classList.add("hidden");
            });
            document.querySelector('#toggle-button-holder').classList.add('ogham-selected');
            document.querySelector('#toggle-button-holder').classList.remove('seanchlo-selected');

        } else {
            document.querySelectorAll('.ogham').forEach((item) => {
                    item.classList.add("hidden");
            });
            document.querySelectorAll('.seanchlo').forEach((item) => {
                    item.classList.remove("hidden");
            });
            document.querySelector('#toggle-button-holder').classList.remove('ogham-selected');
            document.querySelector('#toggle-button-holder').classList.add('seanchlo-selected');

        }
      }
      // define some bits:
      let countDowns = [
      {% for countdown in countdowns %}
          {
            target: document.querySelector("#{{ countdown.label }}-days"),
            start_time: new Date("{{ countdown.start_time }}")
            end_time: new Date("{{ countdown.end_time }}")
          }{% if not loop.last %},{% endif %}
      {% endfor %}
      ];

      let year = document.querySelector("#year");
      let month =document.querySelector("#month");
      let day =document.querySelector("#day");
      let hour =document.querySelector("#hour");
      let minute =document.querySelector("#minute");
      let second =document.querySelector("#second");

    function update_countdown(days_element, start_time, end_time, now){
      let event_duration = end_time - start_time;
      let millisInASecond = 1000;
      let millisInAMinute = 60 * millisInASecond;
      let millisInAnHour = 60 * millisInAMinute;
      let millisInADay = 24 * millisInAnHour;
      let now_label = event_duration >= millisInADay ? "&#128516INNIU&#128516;": "&#128516;ANOIS&#128516;";
      let timeDiffToStart = start_time - now;
      let timeDiffToEnd = end_time - now;
      if (timeDiffToEnd < 0) {
        days_element.innerHTML = "&#128516;Done&#128516;";
        return;
      }
      if (timeDiffToStart <= 0 && timeDiffToEnd > 0) {
	      days_element.innerHTML = now_label;
	      return;
      }
      let days = Math.floor(timeDiffToStart / millisInADay);
      let hours = Math.floor((timeDiffToStart - (days * millisInADay)) / millisInAnHour);
      let minutes = Math.floor((timeDiffToStart - (hours * millisInAnHour)) / millisInAMinute);
      let seconds = Math.floor((timeDiffToStart - (minutes * millisInAMinute)) / millisInASecond);
      if (days > 0) {
	      days_element.innerHTML = `${days} l&#225;`;
	      return;
      }
      if (hours > 0){
	      days_element.innerHTML = `${hours} n-uaire`;
	      return;
      }
      if (minutes > 0) {
	      days_element.innerHTML = `${minutes} n&#243;im&#233;ad`;
	      return;
      }
      days_element.innerHTML = `${seconds} soicind`;
    }

    function update_clock(y, mo, d, h, min, s, now) {
          let day = now.getDate();
          let hours = now.getHours();
          if (hours < 10) {
            hours = `0${hours}`;
          }
          let minutes = now.getMinutes();
          if (minutes < 10) {
            minutes = `0${minutes}`;
          }
          let seconds = now.getSeconds();
          if (seconds < 10) {
            seconds = `0${seconds}`;
          }
          let year = now.getFullYear();
          let month = now.getMonth() + 1;
          if (month < 10) {
            month = `0${month}`;
          }
        y.innerHTML = year;
        mo.innerHTML = month;
        d.innerHTML = day;
        h.innerHTML = hours;
        min.innerHTML = minutes;
        s.innerHTML = seconds;
    }

    function tick() {
        let now = new Date();
        // clock bits:
        update_clock(year, month, day, hour, minute, second, now);
        countDowns.forEach((cd) => {
            update_countdown(cd.target, cd.start_time, cd.end_time, now);
        });
    }

    setInterval(tick, 1000);

    document.querySelector("#toggle-button-holder").addEventListener("click", toggleOgham);
</script>
{% include "components/close_boiler_plate.html" %}
